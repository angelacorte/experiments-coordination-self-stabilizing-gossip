incarnation: collektive

variables:
  fileName: &fileName
    "time-rep-gossip-sm"
  path: &path
    "data/time-rep-gossip-sm"
  maxSeed: &maxSeed
    type: SystemEnvVariable
    parameters: [ "MAX_SEED", 4 ]
  seed: &seed
    min: 0
    max: *maxSeed
    step: 1
    default: 42
  initialNodes: &initialNodes
    type: ArbitraryVariable
    parameters: [ 50, [ 1, 2, 10, 50, 100 ] ]
  shouldFindMax: &shouldFindMax
    type: SystemEnvVariable
    parameters: [ "FIND_MAX", true ]
  findMax: &findMax
    type: ArbitraryVariable
    parameters: [ *shouldFindMax, [true, false] ]
#    type: SystemEnvVariable
#    parameters: [ "FIND_MAX", true ]
  movingRange: &movingRange
    5.0
  width: &width
    10
  leftStart: &leftStart
    0
  height: &height
    20
#  walking_speed: &walk-speed { default: 1.4, min: 1, max: 2, step: 0.1 }

seeds:
  scenario: *seed
  simulation: *seed

network-model:
  type: ConnectWithinDistance
  parameters: [4]

#environment:
#  type: ImageEnvironment
#  parameters: [rectangle.png]

_pool: &program
  - time-distribution: 1
    type: Event
    actions:
      - type: RunCollektiveProgram
        parameters: [ it.unibo.collektive.experiments.TimeRepGossipKt.timeRepGossipEntrypoint]
#  - time-distribution: 10
#    type: Event
#    actions:
#      - type: LevyWalk
#        parameters: [ 1.4, 1, 2, 0.1 ]

_divide: &divide
  - time-distribution:
      type: Trigger
      parameters: [ 50 ]
    type: Event
    actions:
      - type: MoveCluster
        parameters: [ *movingRange ]

_merging: &merging
  - time-distribution:
      type: Trigger
      parameters: [ 150 ]
    type: Event
    actions:
      - type: MoveCluster
        parameters: [ -5 ]

deployments:
  - type: Rectangle
    parameters: [*initialNodes, *leftStart, 0, *width, *height]
    programs:
      - *program
    contents:
      - molecule: findMax
        concentration: *findMax
    properties:
      - type: it.unibo.collektive.alchemist.device.sensors.impl.TimeSensorProperty
      - type: it.unibo.collektive.alchemist.device.sensors.impl.RandomNodeProperty
  - type: Rectangle
    parameters: [*initialNodes, *width, 0, *width, *height]
    programs:
      - *program
      - *divide
      - *merging
    contents:
      - molecule: findMax
        concentration: *findMax
    properties:
      - type: it.unibo.collektive.alchemist.device.sensors.impl.TimeSensorProperty
      - type: it.unibo.collektive.alchemist.device.sensors.impl.RandomNodeProperty

terminate:
  type: AfterTime
  parameters: 200

export:
  - type: CSVExporter
    parameters:
      fileNameRoot: *fileName
      interval: 1.0
      exportPath: *path
    data:
      - time
      - type: NumberOfNodes
      - type: ErrorExtractor
        parameters: [*findMax]
      - molecule: MessageSize
        aggregators: [ max, mean, variance, median, StandardDeviation ]
        value-filter: onlyfinite
        precision: 3
      - molecule: MessageSize
        aggregators: [ Sum ]